# STUDENT ENROLLMENT PREDICTION MODEL - FULL PYTHON SCRIPT
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import (
    classification_report, 
    confusion_matrix, 
    roc_curve
)
import matplotlib.pyplot as plt
import seaborn as sns

# 1. SYNTHETIC SAMPLE DATA (Replace with your real CSV later)
np.random.seed(42)

num_students = 500

data = pd.DataFrame({
    "age": np.random.randint(17, 30, num_students),
    "gender": np.random.choice(["Male", "Female"], num_students),
    "math_score": np.random.randint(40, 100, num_students),
    "english_score": np.random.randint(40, 100, num_students),
    "high_school_GPA": np.random.uniform(1.5, 4.0, num_students),
    "family_income": np.random.choice(["Low", "Medium", "High"], num_students),
    "distance_from_school_km": np.random.uniform(1, 50, num_students),
    "parent_education_level": np.random.choice(["Primary", "Secondary", "College"], num_students),
    "enrolled": np.random.choice([0, 1], num_students, p=[0.4, 0.6])  # Target
})

print("Sample Data Preview:")
print(data.head())

# 2. DATA PREPROCESSING
label_cols = ["gender", "family_income", "parent_education_level"]

le = LabelEncoder()
for col in label_cols:
    data[col] = le.fit_transform(data[col])

# 3. SPLITTING INTO TRAIN & TEST SETS
X = data.drop("enrolled", axis=1)
y = data["enrolled"]

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)

# 4. MODEL TRAINING - RANDOM FOREST
model = RandomForestClassifier(n_estimators=200, random_state=42)
model.fit(X_train, y_train)

# 5. MODEL EVALUATION
y_pred = model.predict(X_test)
y_pred_prob = model.predict_proba(X_test)[:, 1]

print("\n---------------- CLASSIFICATION REPORT ----------------")
print(classification_report(y_test, y_pred))

# 6. CONFUSION MATRIX VISUALIZATION
plt.figure(figsize=(6,4))
sns.heatmap(confusion_matrix(y_test, y_pred), annot=True, cmap="Blues", fmt="d")
plt.title("CONFUSION MATRIX")
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.show()

# 7. ROC CURVE
fpr, tpr, _ = roc_curve(y_test, y_pred_prob)
plt.figure(figsize=(6,4))
plt.plot(fpr, tpr)
plt.title("ROC CURVE")
plt.xlabel("False Positive Rate")
plt.ylabel("True Positive Rate")
plt.grid(True)
plt.show()

# 8. FEATURE IMPORTANCE PLOT
feat_imp = pd.Series(model.feature_importances_, index=X.columns)
feat_imp.nlargest(10).plot(kind="barh", figsize=(8,5))
plt.title("TOP 10 MOST IMPORTANT FEATURES")
plt.xlabel("Importance Score")
plt.show()
